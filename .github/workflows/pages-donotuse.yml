
name: Deploy to GitHub Pages

# Deploy only when pushing to main (adjust branch if needed)
on:
  push:
    branches: [ "origin/main" ]

# Least-privilege token: allow Pages deployment + OIDC for provenance
permissions:
  pages: write     # to deploy to Pages
  id-token: write  # to verify the deployment

concurrency:
  group: pages-${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.19.0'
          check-latest: true
          # Built-in package manager caching (npm/yarn/pnpm) keyed by lockfile
          cache: 'npm'                     # package-lock.json required
            # If you prefer manual cache control, replace the above with actions/cache & a lockfile hash key.

      - name: Sanity check
        run: node -v


      - name: Install dependencies
        run: npm ci

      - name: Build for Pages (set correct base path)
        env:
          GH_PAGES: "1"                # your vite.config.ts uses this flag to set base: '/<REPO_NAME>/'
        run: npm run build

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: dist                   # Viteâ€™s output folder

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
