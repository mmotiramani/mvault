
name: CI (Build & Test)

on:
  push:
    branches: [ "**" ]       # run on all branches
  pull_request:
    branches: [ "**" ]

jobs:
  build:
    runs-on: ubuntu-latest

    # Avoid overlapping runs on the same ref when you push quickly
    concurrency:
      group: ci-${{ github.ref }}
      cancel-in-progress: true

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          # Built-in package manager caching (npm/yarn/pnpm) keyed by lockfile
          cache: 'npm'                     # package-lock.json required
      # If you prefer manual cache control, replace the above with actions/cache & a lockfile hash key.

      - name: Install dependencies (CI mode)
        run: npm ci
        # npm ci uses package-lock.json for reproducible installs on CI
        # and is the recommended approach with setup-node + lockfile

      - name: Type & Svelte checks (optional, since you have a 'check' script)
        run: npm run check

      - name: Build
        env:
          GH_PAGES: "0"                    # normal base for local/PR builds
        run: npm run build
